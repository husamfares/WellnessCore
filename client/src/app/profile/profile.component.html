<div class="profile-container">
  <div class="profile-header">
    <div class="avatar-picture">
      <img 
        *ngIf="imageUrl; else placeholder" 
        [src]="imageUrl" 
        alt="Profile Picture" 
        class="profile-img" 
        (click)="openImageModal()" 
      />

      <ng-template #placeholder>
        <div class="avatar-placeholder">
          <span>{{ profile?.username?.charAt(0) | uppercase }}</span>
        </div>
      </ng-template>
    </div>

    <div *ngIf="isOwner" class="upload-controls">
      <input type="file" (change)="onFileSelected($event)" id="fileInput" />
      <label for="fileInput" class="choose-file-btn">Choose File</label>
      <button (click)="uploadImage()" class="upload-btn">Upload</button>
    </div>

    <h2>{{ profile?.username }}'s Profile</h2>
    <div class="role-badge" [ngClass]="'role-' + profile?.role?.toLowerCase()">
      {{ profile?.role }}
    </div>
  </div>

  <div class="profile-details">
    <div class="detail-item">
      <i class="fas"><mat-icon style="margin-top: 30px;">phone</mat-icon></i>
      <div>
        <span class="detail-label">Mobile</span>
        <span class="detail-value">{{ profile?.mobileNumber || 'Not provided' }}</span>
      </div>
    </div>

    <div class="detail-item">
      <i class="fas"><mat-icon style="margin-top: 30px;">location_on</mat-icon></i>
      <div>
        <span class="detail-label">Location</span>
        <span class="detail-value">{{ profile?.location || 'Not specified' }}</span>
      </div>
    </div>

    <div class="detail-item" *ngIf="profile?.role === 'Trainer'">
      <i class="fas"><mat-icon style="margin-top: 30px;">fitness_center</mat-icon></i>
      <div>
        <span class="detail-label">Gym</span>
        <span class="detail-value">{{ profile?.gymName || 'Not specified' }}</span>
      </div>
    </div>
  </div>

  <form *ngIf="isOwner" [formGroup]="form" (ngSubmit)="updateProfile()" class="edit-form">
    <h3><i class="fas fa-user-edit"></i> Edit Profile</h3>

    <div class="form-group">
      <label for="mobileNumber">Mobile Number</label>
      <input id="mobileNumber" type="tel" class="form-control white-placeholder" formControlName="mobileNumber" placeholder="Enter mobile number">
    </div>

    <div class="form-group">
      <label for="location">Location</label>
      <input id="location" type="text" class="form-control white-placeholder" formControlName="location" placeholder="Enter your location">
    </div>

    <div class="form-group" *ngIf="profile?.role === 'Trainer'">
      <label for="gymName">Gym Name</label>
      <input id="gymName" type="text" class="form-control white-placeholder" formControlName="gymName" placeholder="Enter gym name">
    </div>

    <button class="update-btn" type="submit" [disabled]="form.invalid">
      <i class="fas"><mat-icon class="fas">save</mat-icon></i> Update Profile
    </button>
  </form>
</div>

<div class="image-modal" *ngIf="isImageModalOpen" (click)="closeImageModal()">
  <div class="image-modal-content" (click)="$event.stopPropagation()">
    <span class="close-button" (click)="closeImageModal()">Ã—</span>
    <img [src]="imageUrl" alt="Full Image" />
  </div>
</div>
